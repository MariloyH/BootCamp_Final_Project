<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Se agrego toda esta info-->
    <title>Foodiefy</title>
    <link rel="icon" href="http://example.com/favicon.png">
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <!--Fin de información agregada-->

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>

</head>
<body>
    <!--Incio de agregado de informacion-->
    <div class="wrapper">
        <!-- NAVBAR -->
        <nav class="navbar navbar-dark bg-dark navbar-expand-lg">
          <a class="navbar-brand" href="index_try.html">Foodiefy</a>
        </nav>  
        <!--  JUMBOTRON -->
        <div class="jumbotron">
          <h1 class="display-4">Foodiefy</h1>
           <h3>Recommendations from your digital local buddy!</h3>
        </div>

        <!-- TITLE AND PARAGRAPH-->
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-4">
            <h3>Welcome!! </h3>
              <h2>Philadelphia, Pensilvania</h2>
              <h5> Local time: <span id="time"> </span></h4>
                 <!--  <script src="app.js">   </script> -->
              <h5> What are you hungry for? Follow the instructions: </h5>
          </div>
          <div class="col-md-8">
            <p>Travel is a fun activity, and we always want to enjoy that time to the fullest, including the food experience. That is when a friend recommendation is worthy, and that's why this App is for! We will give you the nearest top rated restaurants according your personal preferences, based in thounsand of other users recommendations
               assuring no bias, since we do not consider the advertising of the business itself for our recommendations. Let your digital local buddy  find options for ypu  and enjoy your trip!
          </div>
        </div>
      </div>

      <div class="container-fluid">
        <div class="row">
          <div class="col-md-4">
            <div class="filters">

              <form > 
                <p>Filter Search</p>
                <ul class="list-group">

                  <li class="list-group-item ">
                    <label for="keyword">What are you looking for? Give me 3 words to simplify your requierements.</label>
                    <input type="text" id="keywords" class="form-control" placeholder="Romantic, italian, dinner " />
                  </li>

                  <li class="list-group-item">
                    <label for="coordinates">Where are you now? Select your location in the map and the values will be displayed automatically. </label>
                    <input type="text" id="coordinates1" class="form-control" placeholder="39.95"  readonly/>
                    <input type="text" id="coordinates2" class="form-control" placeholder="-75.18" readonly/>
                  </li>
                  <!--AGREGAR CODIGO de cuando se mande la información-->
                    <button type="button" onclick="sendInformation()"> Submit </button>
                </ul>
              </form>
            </div>                   
          </div>

        <!-- TABLE, el primero div no se ha cerrado-->
          <div class="col-md-8">
            <table class="table table-striped">
              <!--<thead> -->
                <input type="text" id="coords" class="form-control" placeholder="Select your location to obtain your coordinates" readonly />
                    <meta charset="utf-8">
                    <title>Get coordinates of the mouse pointer</title>
                    
                   <!--- <body>  -->
                      <style type="text/css">
                          #info {
                            display: table;
                            position: relative;
                            margin: 0px auto;
                            word-wrap: anywhere;
                            white-space: pre-wrap;
                            padding: 10px;
                            border: none;
                            border-radius: 3px;
                            font-size: 12px;
                            text-align: center;
                            color: #222;
                            background: #fff;  }

                            html,
                            body,
                            #mapid {
                            width: 100%;
                            height: 100%;
                            padding: 0;
                            margin: 0; }
                      </style>
  
    <!--Fin de agregado de información -->

            <!-- The div that holds our map -->
            <div id="mapid"></div>  

            <!-- Leaflet JavaScript -->
            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
            <pre id="info"></pre>
    
        <script>
        // Create the map object with a center and zoom level.
            let map = L.map("mapid", {
            center: [ 40, -75],
                zoom: 10 });

            // We create the tile layer that will be the background of our map.
            let streets = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data © <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery (c) <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            accessToken: 'pk.eyJ1IjoiYW50b241MDUiLCJhIjoiY2w0bjVuamY2MTQyNjNpbHh0MTV4cnRqcSJ9.55yav3fmjV9ZCGHiHnW16A'
                        });
            // Then we add our tile layer to the map.
            streets.addTo(map);   
            
            //Get coordinates when clicking map
            map.on('click', function(e) {
                                //alert("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
                                console.log(e.latlng.lng);
                                console.log(typeof(e.latlng.lng));
                                console.log(e.latlng.lat);
                                console.log(typeof(e.latlng.lat));

                                var latitud = e.latlng.lat;
                                var longitud = e.latlng.lng;

                            //Show longitude and latitude into the form
                            document.getElementById('coordinates1').value = latitud;
                            document.getElementById('coordinates2').value = longitud;
                      });
            
            //Create function to send information to Flask
            var userinfo = {};
            function sendInformation(){
                let latitude = document.getElementById("coordinates1").value
                let longitude = document.getElementById("coordinates2").value
                let words = document.getElementById("keywords").value
                userinfo = {latitude, longitude, words} //create a dictionary to store the variables

                var s = JSON.stringify(userinfo); //pass the dictionary into json format
                //console.log(s);
                
                $.ajax({
                    url:"/test", //the route where the data will be send
                    type:'POST', 
                    contentType: "application/json",
                    data: JSON.stringify(s)
                });

                //Inicia agregado de información 
                var url_json = 'top7recommendations.json'
                var  geojsonMarkerOptions = {
                    'radius':6,
                    'opacity': .5,
                    'color': "red",
                    'fillColor':  "blue",
                    'fillOpacity': 0.8
                };

                function forEachFeature(feature, layer) {
                
                        var popupContent = "<p>The restaurant <b>" +
                                feature.properties.name + "</b> ,</br> The categories are " +
                                feature.properties.categories + "</br>" ;
                                        
                        if (feature.properties && feature.properties.popupContent) {
                            popupContent += feature.properties.popupContent;
                        }
                            layer.bindPopup(popupContent);
                };


                var top7 = L.geoJSON(null, {
                        onEachFeature: forEachFeature, 
                        pointToLayer: function (feature, latlng) {
                            return L.circleMarker(latlng, geojsonMarkerOptions);
                        }
                });

                    // Get GeoJSON data and create features.
                    $.getJSON(url_json, function(data) {
                            top7.addData(data);
                    });
                    
                    top7.addTo(map);

                //Finaliza agregado de información
            };

                </script>
            </table>
        </div>

</body>
</html>